import Head from 'next/head'
import Link from 'next/link'
import { Heading, Flex, Stack, Divider, VStack } from '@chakra-ui/react'
import fs from 'fs'
import path from 'path'
import matter from 'gray-matter'
import { ContentBanner } from '../../components/ContentBanner'

interface LessonProps {
  lessons: {
    path: string
    frontMatter: any
    slug: string
  }[]
}

const Lessons: React.FC<LessonProps> = ({ lessons }) => {
  return (
    <>
      <Head>
        <title>D_D School of Code</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Flex as="main" py={5} px={[4, 10, 16]} direction="column" minH="90vh">
        <Stack spacing={5} direction="column">
          {lessons.map((lesson: any, idx: number) => (
            <VStack>
              <Link
                key={lesson.slug}
                href={`${lesson.path}/${lesson.slug}`}
                passHref
              >
                <ContentBanner lesson={lesson} idx={idx} />
              </Link>
            </VStack>
          ))}
        </Stack>
      </Flex>
    </>
  )
}

export default Lessons

export const getStaticProps = async () => {
  const directories = fs.readdirSync(path.join('lessons'))
  const lessons: object[] = []
  directories.reverse().map((filename) => {
    fs.readdirSync(path.join('lessons', filename)).map((file) => {
      const markdownWithMeta = fs.readFileSync(
        path.join('lessons', filename, file),
        'utf-8',
      )

      const { data: frontMatter } = matter(markdownWithMeta)
      lessons.push({
        path: filename,
        frontMatter,
        slug: `${file.replace('.mdx', '')}`,
      })
    })
  })
  return {
    props: {
      lessons,
    },
  }
}
